var tongDonHang = 0;
var tongTienTietKiem = 0;
var tongtienhang = 0;
var tongtienhangchuagiam = 0;
var tongSanPhamDaMua = 0;
var trangThaiDonHangConKhong = true;
var offset = 0;
var si = 20;

// Thá»‘ng kÃª theo thá»i gian
var thongKeTheoThang = {
  '1_thang': { tongTien: 0, donHang: 0, sanPham: 0, tienChuaGiam: 0 },
  '3_thang': { tongTien: 0, donHang: 0, sanPham: 0, tienChuaGiam: 0 },
  '6_thang': { tongTien: 0, donHang: 0, sanPham: 0, tienChuaGiam: 0 },
  '1_nam': { tongTien: 0, donHang: 0, sanPham: 0, tienChuaGiam: 0 }
};

// Thá»‘ng kÃª theo nÄƒm
var thongKeTheoNam = {};

function xemBaoCaoThongKe() {
  var orders = [];
  var xhttp = new XMLHttpRequest();
  xhttp.onreadystatechange = function () {
    if (this.readyState == 4 && this.status == 200) {
      orders = JSON.parse(this.responseText)['data']['details_list'];
      
      tongDonHang += orders.length;
      trangThaiDonHangConKhong = orders.length >= si;
      
      // Thá»i gian hiá»‡n táº¡i
      var now = new Date();
      var oneMonthAgo = new Date(now.getFullYear(), now.getMonth() - 1, now.getDate());
      var threeMonthsAgo = new Date(now.getFullYear(), now.getMonth() - 3, now.getDate());
      var sixMonthsAgo = new Date(now.getFullYear(), now.getMonth() - 6, now.getDate());
      var oneYearAgo = new Date(now.getFullYear() - 1, now.getMonth(), now.getDate());
      
      orders.forEach(order => {
        var orderTime = getOrderTime(order);
        var orderYear = orderTime.getFullYear();
        
        let tongTienDonHang = order['info_card']['final_total'] / 100000;
        tongtienhang += tongTienDonHang;
        
        let tongTienChuaGiamDonHang = 0;
        let soSanPhamDonHang = 0;
        
        order['info_card']['order_list_cards'].forEach(item => {
          item['product_info']['item_groups'].forEach(itemGroups => {
            itemGroups['items'].forEach(data => {
              let t5 = data['order_price'] / 100000;
              soSanPhamDonHang += data['amount'];
              tongSanPhamDaMua += data['amount'];
              tongTienChuaGiamDonHang += t5;
              tongtienhangchuagiam += t5;
            });
          });
        });
        
        // Thá»‘ng kÃª theo thá»i gian gáº§n Ä‘Ã¢y
        if (orderTime >= oneMonthAgo) {
          thongKeTheoThang['1_thang'].tongTien += tongTienDonHang;
          thongKeTheoThang['1_thang'].donHang += 1;
          thongKeTheoThang['1_thang'].sanPham += soSanPhamDonHang;
          thongKeTheoThang['1_thang'].tienChuaGiam += tongTienChuaGiamDonHang;
        }
        if (orderTime >= threeMonthsAgo) {
          thongKeTheoThang['3_thang'].tongTien += tongTienDonHang;
          thongKeTheoThang['3_thang'].donHang += 1;
          thongKeTheoThang['3_thang'].sanPham += soSanPhamDonHang;
          thongKeTheoThang['3_thang'].tienChuaGiam += tongTienChuaGiamDonHang;
        }
        if (orderTime >= sixMonthsAgo) {
          thongKeTheoThang['6_thang'].tongTien += tongTienDonHang;
          thongKeTheoThang['6_thang'].donHang += 1;
          thongKeTheoThang['6_thang'].sanPham += soSanPhamDonHang;
          thongKeTheoThang['6_thang'].tienChuaGiam += tongTienChuaGiamDonHang;
        }
        if (orderTime >= oneYearAgo) {
          thongKeTheoThang['1_nam'].tongTien += tongTienDonHang;
          thongKeTheoThang['1_nam'].donHang += 1;
          thongKeTheoThang['1_nam'].sanPham += soSanPhamDonHang;
          thongKeTheoThang['1_nam'].tienChuaGiam += tongTienChuaGiamDonHang;
        }
        
        // Thá»‘ng kÃª theo nÄƒm
        if (!thongKeTheoNam[orderYear]) {
          thongKeTheoNam[orderYear] = {
            tongTien: 0,
            donHang: 0,
            sanPham: 0,
            tienChuaGiam: 0
          };
        }
        thongKeTheoNam[orderYear].tongTien += tongTienDonHang;
        thongKeTheoNam[orderYear].donHang += 1;
        thongKeTheoNam[orderYear].sanPham += soSanPhamDonHang;
        thongKeTheoNam[orderYear].tienChuaGiam += tongTienChuaGiamDonHang;
      });
      
      offset += si;
      if (trangThaiDonHangConKhong) {
        console.log('ÄÃ£ thá»‘ng kÃª Ä‘Æ°á»£c: ' + tongDonHang + ' Ä‘Æ¡n hÃ ng. Äang láº¥y thÃªm dá»¯ liá»‡u....');
        xemBaoCaoThongKe();
      } else {
        tongTienTietKiem = tongtienhangchuagiam - tongtienhang;
        
        // Tá»”NG QUAN
        console.log('\n');
        console.log('%câ•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—', 'font-size: 16px; color: #ff5722;');
        console.log('%câ•‘           ğŸ“Š BÃO CÃO THá»NG KÃŠ SHOPEE TOÃ€N DIá»†N            â•‘', 'font-size: 16px; color: #ff5722;');
        console.log('%câ•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•', 'font-size: 16px; color: #ff5722;');
        console.log('\n');
        
        console.log('%c' + PXGCert(tongtienhang), 'font-size:26px; font-weight: bold;');
        console.log('\n');
        
        console.log('%cğŸ”¥ Tá»”NG QUAN TOÃ€N Bá»˜ THá»œI GIAN', 'font-size: 22px; color: #ff9800; font-weight: bold;');
        console.log('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”');
        console.log(
          '%cğŸ’° Tá»•ng chi tiÃªu: ' + '%c' + pxgPrice(tongtienhang) + ' vnÄ‘',
          'font-size: 20px;',
          'font-size: 26px; color: #f44336; font-weight: bold;',
        );
        console.log(
          '%cğŸ“¦ Tá»•ng Ä‘Æ¡n hÃ ng: ' + '%c' + pxgPrice(tongDonHang) + ' Ä‘Æ¡n',
          'font-size: 18px;',
          'font-size: 20px; color: #4caf50; font-weight: bold;',
        );
        console.log(
          '%cğŸ›ï¸ Tá»•ng sáº£n pháº©m: ' + '%c' + pxgPrice(tongSanPhamDaMua) + ' sáº£n pháº©m',
          'font-size: 18px;',
          'font-size: 20px; color: #2196f3; font-weight: bold;',
        );
        console.log(
          '%cğŸ‰ Tiáº¿t kiá»‡m Ä‘Æ°á»£c: ' + '%c' + pxgPrice(tongTienTietKiem) + ' vnÄ‘',
          'font-size: 18px;',
          'font-size: 20px; color: #4caf50; font-weight: bold;',
        );
        console.log('\n');
        
        // THá»NG KÃŠ THEO THá»œI GIAN Gáº¦N ÄÃ‚Y
        console.log('%câ° THá»NG KÃŠ THEO THá»œI GIAN Gáº¦N ÄÃ‚Y', 'font-size: 22px; color: #2196f3; font-weight: bold;');
        console.log('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”');
        
        // 1 thÃ¡ng gáº§n nháº¥t
        var tietKiem1Thang = thongKeTheoThang['1_thang'].tienChuaGiam - thongKeTheoThang['1_thang'].tongTien;
        console.log('%cğŸ“… 1 THÃNG Gáº¦N NHáº¤T:', 'font-size: 18px; color: #ff9800; font-weight: bold;');
        console.log('   ğŸ’° Chi tiÃªu: %c' + pxgPrice(thongKeTheoThang['1_thang'].tongTien) + ' vnÄ‘', 'color: #f44336; font-weight: bold;');
        console.log('   ğŸ“¦ ÄÆ¡n hÃ ng: ' + pxgPrice(thongKeTheoThang['1_thang'].donHang) + ' Ä‘Æ¡n');
        console.log('   ğŸ›ï¸ Sáº£n pháº©m: ' + pxgPrice(thongKeTheoThang['1_thang'].sanPham) + ' sáº£n pháº©m');
        console.log('   ğŸ‰ Tiáº¿t kiá»‡m: %c' + pxgPrice(tietKiem1Thang) + ' vnÄ‘', 'color: #4caf50;');
        console.log('');
        
        // 3 thÃ¡ng gáº§n nháº¥t
        var tietKiem3Thang = thongKeTheoThang['3_thang'].tienChuaGiam - thongKeTheoThang['3_thang'].tongTien;
        console.log('%cğŸ“… 3 THÃNG Gáº¦N NHáº¤T:', 'font-size: 18px; color: #ff9800; font-weight: bold;');
        console.log('   ğŸ’° Chi tiÃªu: %c' + pxgPrice(thongKeTheoThang['3_thang'].tongTien) + ' vnÄ‘', 'color: #f44336; font-weight: bold;');
        console.log('   ğŸ“¦ ÄÆ¡n hÃ ng: ' + pxgPrice(thongKeTheoThang['3_thang'].donHang) + ' Ä‘Æ¡n');
        console.log('   ğŸ›ï¸ Sáº£n pháº©m: ' + pxgPrice(thongKeTheoThang['3_thang'].sanPham) + ' sáº£n pháº©m');
        console.log('   ğŸ‰ Tiáº¿t kiá»‡m: %c' + pxgPrice(tietKiem3Thang) + ' vnÄ‘', 'color: #4caf50;');
        console.log('');
        
        // 6 thÃ¡ng gáº§n nháº¥t
        var tietKiem6Thang = thongKeTheoThang['6_thang'].tienChuaGiam - thongKeTheoThang['6_thang'].tongTien;
        console.log('%cğŸ“… 6 THÃNG Gáº¦N NHáº¤T:', 'font-size: 18px; color: #ff9800; font-weight: bold;');
        console.log('   ğŸ’° Chi tiÃªu: %c' + pxgPrice(thongKeTheoThang['6_thang'].tongTien) + ' vnÄ‘', 'color: #f44336; font-weight: bold;');
        console.log('   ğŸ“¦ ÄÆ¡n hÃ ng: ' + pxgPrice(thongKeTheoThang['6_thang'].donHang) + ' Ä‘Æ¡n');
        console.log('   ğŸ›ï¸ Sáº£n pháº©m: ' + pxgPrice(thongKeTheoThang['6_thang'].sanPham) + ' sáº£n pháº©m');
        console.log('   ğŸ‰ Tiáº¿t kiá»‡m: %c' + pxgPrice(tietKiem6Thang) + ' vnÄ‘', 'color: #4caf50;');
        console.log('');
        
        // 1 nÄƒm gáº§n nháº¥t
        var tietKiem1Nam = thongKeTheoThang['1_nam'].tienChuaGiam - thongKeTheoThang['1_nam'].tongTien;
        console.log('%cğŸ“… 1 NÄ‚M Gáº¦N NHáº¤T:', 'font-size: 18px; color: #ff9800; font-weight: bold;');
        console.log('   ğŸ’° Chi tiÃªu: %c' + pxgPrice(thongKeTheoThang['1_nam'].tongTien) + ' vnÄ‘', 'color: #f44336; font-weight: bold;');
        console.log('   ğŸ“¦ ÄÆ¡n hÃ ng: ' + pxgPrice(thongKeTheoThang['1_nam'].donHang) + ' Ä‘Æ¡n');
        console.log('   ğŸ›ï¸ Sáº£n pháº©m: ' + pxgPrice(thongKeTheoThang['1_nam'].sanPham) + ' sáº£n pháº©m');
        console.log('   ğŸ‰ Tiáº¿t kiá»‡m: %c' + pxgPrice(tietKiem1Nam) + ' vnÄ‘', 'color: #4caf50;');
        console.log('\n');
        
        // THá»NG KÃŠ THEO NÄ‚M
        console.log('%cğŸ“Š THá»NG KÃŠ CHI TIÃŠU THEO NÄ‚M', 'font-size: 22px; color: #9c27b0; font-weight: bold;');
        console.log('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”');
        
        // Sáº¯p xáº¿p cÃ¡c nÄƒm theo thá»© tá»± giáº£m dáº§n
        var sortedYears = Object.keys(thongKeTheoNam).sort((a, b) => b - a);
        
        sortedYears.forEach(year => {
          var data = thongKeTheoNam[year];
          var tietKiemNam = data.tienChuaGiam - data.tongTien;
          console.log('%cğŸ—“ï¸ NÄ‚M ' + year + ':', 'font-size: 18px; color: #ff9800; font-weight: bold;');
          console.log('   ğŸ’° Chi tiÃªu: %c' + pxgPrice(data.tongTien) + ' vnÄ‘', 'color: #f44336; font-weight: bold;');
          console.log('   ğŸ“¦ ÄÆ¡n hÃ ng: ' + pxgPrice(data.donHang) + ' Ä‘Æ¡n');
          console.log('   ğŸ›ï¸ Sáº£n pháº©m: ' + pxgPrice(data.sanPham) + ' sáº£n pháº©m');
          console.log('   ğŸ‰ Tiáº¿t kiá»‡m: %c' + pxgPrice(tietKiemNam) + ' vnÄ‘', 'color: #4caf50;');
          console.log('');
        });
        
        console.log('\n');
        console.log('%câ•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—', 'font-size: 16px; color: #4caf50;');
        console.log('%câ•‘                    ğŸ’ THÃ”NG TIN Há»®U ÃCH                    â•‘', 'font-size: 16px; color: #4caf50;');
        console.log('%câ•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•', 'font-size: 16px; color: #4caf50;');
        console.log(
          '%cğŸ‘‰ Láº¥y MÃ£ giáº£m giÃ¡ Shopee má»—i ngÃ y: ' + '%chttps://magiamgiashopee.vn',
          'font-size: 18px;',
          'font-size: 18px; color: #ff9800; font-weight: bold;',
        );
        console.log(
          '%cğŸ‘‰ Tham gia group XÃ³m SÄƒn Sale: ' + '%chttps://www.facebook.com/groups/1881099285382553',
          'font-size: 18px;',
          'font-size: 18px; color: #ff9800; font-weight: bold;',
        );
        console.log('\n');
      }
    }
  };

  xhttp.open(
    'GET',
    'https://shopee.vn/api/v4/order/get_order_list?list_type=3&offset=' + offset + '&limit=' + si,
    true,
  );
  xhttp.send();
}
function PXGCert(pri) {
  if (pri <= 10000000) {
    return 'HÃŠN QUÃ! Báº N CHÆ¯A Bá»Š SHOPEE GÃ‚Y NGHIá»†N ğŸ˜';
  } else if (pri > 10000000 && pri <= 50000000) {
    return 'THÃ”I XONG! Báº N Báº®T Äáº¦U NGHIá»†N SHOPEE Rá»’I ğŸ˜‚';
  } else if (pri > 50000000 && pri < 80000000) {
    return 'á»I GIá»œI Æ I! Báº N LÃ€ CON NGHIá»†N SHOPEE CHÃNH HIá»†U ğŸ˜±';
  } else {
    return 'XÃ“A APP SHOPEE THÃ”I! Báº N NGHIá»†N SHOPEE Náº¶NG QUÃ Rá»’I ğŸ˜';
  }
}
function pxgPrice(number, fixed = 0) {
  if (isNaN(number)) return 0;
  number = number.toFixed(fixed);
  let delimeter = ',';
  number += '';
  let rgx = /(\d+)(\d{3})/;
  while (rgx.test(number)) {
    number = number.replace(rgx, '$1' + delimeter + '$2');
  }
  return number;
}
function getOrderTime(order) {
  return new Date(order.shipping.tracking_info.ctime * 1000);
}

xemBaoCaoThongKe();
